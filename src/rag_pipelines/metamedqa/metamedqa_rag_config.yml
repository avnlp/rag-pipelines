# MetaMedQA RAG Configuration

# Dataset configuration
dataset:
  path: "maximegmd/MetaMedQA"
  split: "test"
  question_field: "question"
  answer_field: "answer"
  answer_idx_field: "answer_idx"
  options_field: "options"

# Metadata schema for clinical conversations
metadata_schema:
  properties:
    medical_domain:
      type: "string"
      enum: ["cardiology", "pulmonology", "pediatrics", "congenital_disorders", "general_medicine"]
      description: "Primary medical specialty relevant to the case"
    patient_age_group:
      type: "string"
      enum: ["neonate", "infant", "child", "adolescent", "adult"]
      description: "Age group of the patient described"
    key_findings:
      type: "string"
      description: "Most important clinical findings from the case"
    symptom_context:
      type: "string"
      enum: ["feeding", "rest", "exercise", "sleep", "variable"]
      description: "When the symptoms primarily occur"
    cardiac_findings_present:
      type: "boolean"
      description: "Whether cardiac abnormalities are mentioned in physical exam"
    congenital_condition_suspected:
      type: "boolean"
      description: "Whether this appears to be a congenital condition"

# LLM configurations
llm:
  extractor:
    model: "llama-3.3-70b-versatile"
    temperature: 0
    max_tokens: 1000
    max_retries: 3
  response:
    model: "qwen/qwen3-32b"
    temperature: 0
    max_tokens: 1000
    max_retries: 3
    reasoning_format: "parsed"

# Embedding model
embedding:
  model_name: "Qwen/Qwen3-Embedding-0.6B"

# Contextual Reranker
reranker:
  model: "ContextualAI/ctxl-rerank-v2-instruct-multilingual-1b"
  instruction: "Prioritize Medical articles that directly answer the question."

# Vector store (Milvus)
vectorstore:
  collection_name: "metamedqa"
  vector_fields: ["dense", "sparse"]
  consistency_level: "Strong"
  drop_old: false

# Retriever
retriever:
  k: 5

# RAG prompt
prompt:
  system_message: |
    You are an expert medical educator and diagnostician. Use the retrieved context
    to analyze the clinical case and identify the most likely answer from the options provided.

    CRITICAL INSTRUCTIONS:
    1. Base your reasoning SOLELY on the provided medical context
    2. For medical questions, prioritize the most specific and pathophysiologically relevant information
    3. Explain the clinical reasoning that connects the patient's presentation to the correct answer
    4. If multiple options seem plausible, identify which one best explains ALL the clinical findings
    5. Address why key distractors are less likely based on the clinical context

    Provide your answer in this exact format:
    **Answer: [LETTER]**
    **Explanation:** [Your clinical reasoning]
  human_message: |
    CLINICAL CONTEXT:
    {context}

    QUESTION:
    {question}

    Based on the clinical context above, analyze this case and provide your answer.

# Evaluation metrics with clinical focus
metrics:
  contextual_recall:
    threshold: 0.7
    model: "llama-3.3-70b-versatile"
    include_reason: true
    async_mode: true

  contextual_precision:
    threshold: 0.6
    model: "llama-3.3-70b-versatile"
    include_reason: true
    async_mode: true

  contextual_relevancy:
    threshold: 0.6
    model: "llama-3.3-70b-versatile"
    include_reason: true
    async_mode: true

  answer_relevancy:
    threshold: 0.7
    model: "llama-3.3-70b-versatile"
    include_reason: true
    async_mode: true

  faithfulness:
    threshold: 0.8
    model: "llama-3.3-70b-versatile"
    include_reason: true
    async_mode: true
